# Регрессионное тестирование

## Мониторить простоянно
1. Отсутствие ошибок в консоли JS
2. Отсутствие ошибок в логе бэкенда

Проверки в браузерах Chrome, FF, IE11+

## Редактор
1. Нормальная работа дерева слева
2. Для пользователей с правами ниже редактора не должно быть кнопок правки.

### Река
1. Создать и сохранить реку без региона
2. Создать и сохранить реку в регионе
3. Загрузить GPX с порогами
3. Отредактровать и сохранить существующую реку
3. Проверить работу кнопки "Показывать на карте"
5. Посмотреть свои действия в логе изменений
6. Сменить регион для реки на другой
6. Сменить регион для реки на "-" (без региона)
6. На странице реки нажать F5. Убедиться, что страница перезагрузилась, 
но страница реки по-прежнему открыта и соответствующий пункт в дереве слева выделен
6. В просмотре карты для реки нажать на любой из порогов. Должен совершиться переход на страницу этого порога (без редактирования). 
В дереве слева должен также выделиться новый выбранный порог.
6. Удалить реку

### Порог
1. Создать и сохранить препятствие
2. Отредактировать и сохранить существующее препятствие
2. Добавить точку окончания. Сохранить. Проверить, что изменилось отображение на большой карте. Удалить точку окончания. Снова проверить.
3. Загрузить фото и схемы, не выходя из редактирования. Проверить, что они загружаются на соответствующие вкладки.
4. Удалить изображение и схему.
5. Назначить главное изобажение, проверить, что оно действительно изменилось.
6. Прикрепить видео. Удостовериться, что оно прикрепилось.
7. Сменить реку для порога
8. Посмотреть свои действия в логе изменений
6. В просмотре карты для порога нажать на любой другой порог. Должен совершиться переход на страницу этого порога (без редактирования). 
В дереве слева должен также выделиться новый выбранный порог
    * Порог на той же самой реке
    * Порог на другой реке того же региона
    * Порог на другой реке другого региона и страны
6. На странице порога нажать F5. Убедиться, что страница перезагрузилась, 
но страница реки по-прежнему открыта и соответствующий пункт в дереве слева выделен
6. Нажать кнопку "Редактирование". Всё должно работать как в предыдущем пункте, но другой порог должен открыться также  в режиме редактирования,
а перед переходом должно показаться окно с предупреждением о том, что всё не сохранённое сейчас будет потеряно.
9. Удалить порог

## Карта
1. Карта в IE11+
1. Карта на **huskytm.ru** проверяется по той же схеме, но ссылка из bubble порога должна вести в каталог.
1. Карта на **wwbmstu.ru** проверяется исходя из здравого смысла. Там api v1.


1. На масштабе 6 и менее показывает реки на карте и на области справа. Если подвинуть карту на другой регион, в области справа отобразятся реки, попавшие в область видимости карты.
2. На масштабе 6 и менее при клике на реку увеличивает масштаб таким образом, чтобы было видно расположение порогов. При этом все пороги реки должны попасть в видимую область карты. Нитка реки подсвечивается.
3. При клике на кнопку "Показать на карте" (правая панель) также приближает реку таким образом, чтобы были видны все пороги реки.
4. При клике на порог открывает тултип порога. Если тултип порога при открытии не влезает в поле карты, карта двигается таким образом, чтобы тултип влез.
5. Проверка фильтрации. На масштабе 3 на панели сверху нажимать на категории рек. Реки отображаются согласно выбранной категории и выше. Проверить, что отображение на карте адекватно выбранной категории и выше. Проверить, что отображение на правой панели адекватно выбрной категории и выше.
6. Проверить работу поиска рек по названию реки в строке поиска. Река должна отображаться таким образом, чтобы все её пороги попали в область видимости. Нитка реки подсвечивается. 
7. Ввести название скрытой реки в строке поиска. Проверить, что ничего не нашлось.

### Пороги
1. Проверить отображение порогов на своих местах, категорию.
2. Проверить отображение протяжённых порогов #4
3. Проверить bubble. Отображение фото, схем и видео. Ссылка на редактор.
4. Проверить, что пороги находятся в строке поиска по названию.

### Список рек
1. Проверить актуальность (совпадение с областью карты)
2. Проверить, что кликаются ссылки на область карты и редактор

### Карточка реки
1. Проверить наличие описания
2. Проверить совпадение данных о категории
3. Проверить фотографии, схемы и видео.
4. Скачать GPX на русском и транслитом. Проверить в нём для одного препятствия совпадение координат
5. Проверить наличие и максимальное кол-во отчётов для каждого источника
6. Скачать CSV на русском. Проверить, что кириллица на месте (1251 кодировка). Скачивается, открывается exel'ем.

### Отправка сообщения об ошибке
1. Проверить, что сообщение попало в очередь
2. Проверить, что записался id отправителя

## Периодические задачи
### Автосортировка порогов

### Поиск отчётов
1. Переименовать Катунь в Катунь-test
2. Создать реку с названием Катунь
3. Запустить поиск отчётов
4. Для новой реки список найденных отчётов должен совпадать. Проверяем все источники.

### Выгрузка
#### PDF
#### HuskyTM
Только если робот не забанен

### Резервное копирования
1. Создать бэкап базы (аккуратно, не выкладывая на я-диск, либо сразу удалить)
2. Удалить базу, накатить схему, восстановиться из бэкапа по инструкци

### Уровни воды
1. Проверить что запуск
2. Проверить совпадение уровней в базе с графиками

### Погода
Проверить, что запускается
