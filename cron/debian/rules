#!/usr/bin/make -f
%:
	dh $@

pre-build:
	cd ../lib/dao/queries; $(HOME)/.go/bin/go-bindata -pkg queries .

build-notifier:
	GOPATH="$(HOME)/.go" go install github.com/go-bindata/go-bindata
	cd notifier; $(HOME)/.go/bin/go-bindata email-template; GOPATH="$(HOME)/.go" go build

build-catalog-sync:
	cd catalog-sync; $(HOME)/.go/bin/go-bindata email-template; GOPATH="$(HOME)/.go" go build

build-db-clean:
	cd db-clean; GOPATH="$(HOME)/.go" go build

build: pre-build build-notifier build-catalog-sync build-db-clean

override_dh_auto_install:
	install -D -m 0755 notifier/notifier $$(pwd)/debian/wwmap-cron/usr/bin/wwmap-notifier
	install -D -m 0755 backup/backup.sh $$(pwd)/debian/wwmap-cron/usr/bin/wwmap-backup
	install -D -m 0755 catalog-sync/catalog-sync $$(pwd)/debian/wwmap-cron/usr/bin/wwmap-catalog-sync
	install -D -m 0755 db-clean/db-clean $$(pwd)/debian/wwmap-cron/usr/bin/wwmap-db-clean
